\section{Methods}
\label{sec:methods}

% <intro>

\subsection{Simulation framework}
Algorithm \ref{alg:workflow} show the base workflow of the simulations, which is preserving the original implementation of Y almost entirely.
The only added modification is the opinion update, at the end of the day, that was not present as it is one thing that I implemented. 
Also notice that there are some configurable parameters that change the simulation workflow.
Also notice that in the original implementation it was possible to add and remove agents at the end of the simulated day, which makes the simulations more realistic. However, it was omitted in the algorithm, as this study only focuses on those users who remain subscribed to the platform for the whole studied time. 

Another thing that is different w.r.t. the original implementation is that the actions to perform are selected according to each user's activity, rather than asked to the LLM. This was done to leverage the real data we had available, and to lighten the load on the models.

\begin{algorithm}
\caption{Simulation workflow}
\label{alg:workflow}
\begin{algorithmic}[1]
\REQUIRE Configuration file
\STATE Create initial population

\FOR{$day \in n\_days$}
    \FOR{$round \in n\_rounds$}
        \STATE Get number of expected active users in the current slot
        \STATE Randomly sample active users
        \FOR{$user \in active\_users$}
            \STATE Select and perform an action
            \STATE Reply to received mentions
        \ENDFOR
    \ENDFOR

    \STATE A subset of the daily actives can search an follow a recommended user
    \STATE Update opinions
\ENDFOR
\end{algorithmic}
\end{algorithm}


% content and follow recsys ?
% which topics they speak about
% network: how it is initialized and how it can evolve

\subsection{Agents}
\subsubsection{Initialization}
Agents in Y are initialized with demographic data, personality, interests, and others.
The agents initialized in this work are Italians to be coherent with the context of this work, which is Italian politics before the elections of 2022.
They are aged 18-60. The aged is sampled in a range, chosen among ["18-24", "25-34", "35-49", "50-60"], where the weight of each range was computed starting from \cite{statista2024twitter}. This study only considered users older than 18, to better represent the voters during the elections, and younger than 60, which was the configuration value proposed by Y, and is a good approximation of the maximum common age on Twitter.
Similarly, the gender is randomly chosen, weighted aggregating the data from \cite{statista2024twitter}, only considering people aged 18+.

To complete the characterization of the user, other characteristics have been defined using the python faker library: name, surname, email, password and personality, defined according to the Big 5 personality traits.

To make the user even more realistic, some features have been initialized starting from real-world data. The dataset proposed by \citet{pierri2023ita} ... % <info about the dataset>
Specifically, data initialized with the dataset are: the political leaning, the toxicity in writing tweets and replies, and the activity.
The activity is obtained by converting the number of tweets written by each user into a continuous value in the range 0-1, with the logarithmic normalization:
\[
\min\left( \frac{\log(1 + n_{\text{posts}})}{\log(1 + n_{\text{post\_max}})},\ 1.0 \right)
\]

where $post_max$ is the 99.5 percentile, to reduce the impact of outliers.

All users are initialized with four interests, which correspond to all the four topics discussed in this work: immigration, nuclear energy, civil rights, Reddito di Cittadinanza.

To perform an action, the LLM agent is prompted both with the instructions to follow and with the user profile, which includes the data introduced above and the opinion of the person and the supporting party.
You can find the prompts in the appendix.



\subsubsection{General behavior}
Agents can perform different actions: post, comment, read.
\begin{itemize}
    \item $post$: writing a tweet about one of the topics.
    \item $comment$: after reading a tweet, the agent is asked to comment it. He can then decide to add a reaction (like or dislike), and follow (unfollow) the author.
    \item $read$: after reading a post, the agent decides if he wants to add a reaction and follow (unfollow) the author of the post, without adding any contribution.
\end{itemize}

The action to performed is selected according to the activity of the user to post or comment. The probability to perform a "read" action is what's left from the other probabilities.
The prompts with the instructions can be found in the appendix.

\subsubsection{Misinformation agents}
Some agents are designated to produce misinformation. They are interpreting normal people, who try to support their views by using emotion, selective facts, or made-up data. They are not coordinated agents nor bots.
As all other agents, they are initialized with personal data, and use the same prompt describing the individual, before performing any action.
Coalitions are equally distributed among misinformation agents.
The toxicity of writing posts and comments are randomly generated, based on the curve that best fits the real data, given the coalition.
In a similar way, after computing the best fit of the number of posts and comments written, these values are randomly generated, and then converted to activity, analogously to what is done in normal agent initialization.
The prompt are available in the Appendix.

\subsection{Opinion modeling and update}
Modeling the opinion is one of the crucial aspects for this works. A good opinion modeling means more realistic simulation of the agent behavior and believes.
In this work, we have implemented two types of opinion models in parallel. The first is the mathematical way, and we have implemented some basic score aggregation and various known models. The second better leverages LLM reasoning capabilities, to both express the textual opinion, and assign a score. 
In this subsection we'll enter into the details of these methods implemented.

\subsubsection{Implemented opinion models}
% median, weighted mean
The most basic implementation of opinions are the median and the weighted mean of previous scores, for each individual. These can be used where the opinion scores are externally added, and a final opinion evaluator is needed. For instance, after writing a tweet a score might be extracted and considered as the current user belief. To aggregate all these values to give an overall opinion of the individual, these ways can be used.

% friedkin johnsen
A well-known mathematical model of opinion dynamics is the Friedkin-Johnsen model. As introduced in the previous section, it considers both the user initial opinion and the opinion of the user neighbors (the following, in our case), weighted by a susceptibility value.
The implemented formula is the following:
\[
x_i(t + 1) = (1 - \lambda_i) x_i(0) + \lambda_i  \sum_{j \in N_i(t)} w_{ij} x_j (t)
\]
where $x_i$ is the opinion of individual $i$, $N_i$ is the set of following users, and $\lambda$ is the susceptibility to other users. 
Note that in this first implementation neighbors are followed users, and they all have the same weight.
The susceptibility is a score in the range 0-1 (0 means not susceptible, 1 very susceptible), and is assigned according to the user personality, assigned in the agent initialization phase. Specifically, it is the mean of the susceptibility scores for each assigned personality trait. These scores are visible in Table \ref{tab:susceptibility}, and have been assigned based on to the work presented by \citet{oyibo2019personality}, which highlights the personality impact on the social susceptibility. For the traits that are not mentioned to have a clear strong impact, the neutral score has been assigned.

\begin{table}
\centering
\begin{tabular}{|l|l|c|l|c|}
\hline
\textbf{Trait} & \textbf{High} & \textbf{High Score} & \textbf{Low} & \textbf{Low Score} \\
\hline
Neuroticism        & sensitive/nervous         & 0.9 & resilient/confident     & 0.1 \\
Openness           & inventive/curious         & 0.2 & consistent/cautious     & 0.6 \\
Conscientiousness  & efficient/organized       & 0.2 & extravagant/careless    & 0.6 \\
Extroversion       & outgoing/energetic        & 0.5 & solitary/reserved       & 0.5 \\
Agreeableness      & friendly/compassionate    & 0.5 & critical/judgmental     & 0.5 \\
\hline
\end{tabular}
\caption{Big Five personality traits with associated descriptions and assigned scores.}
\label{tab:susceptibility}
\end{table}

% state dependent friedkin-johnsen
Another implementation implemented for this work is an extension of the Friedkin-Johnsen model which is state-dependent, as it considers the influence of the current opinion, rather than the initial one \cite{Ye2018Opinion}:
\[
x_i(t + 1) = (1 - \lambda) x_i(t) + \lambda  \sum_{j \in N_i(t)} w_{ij} x_j (t)
\]

% weighted state depended fj
The last implementation is the state dependent Friedkin-Johnsen model just introduced, but with different scores for the neighbors. 
First of all, neighbors are not only followed users, but all users the individual has interacted with, since the last opinion update, and their weight depends on the interactions. 
The scores are assigned as follows: following user +1; like/dislike: Â±0.2

% The scores are visible in Table \ref{tab:action_scores}.
% \begin{table}[h]
%     \centering
%     \begin{tabular}{|l|c|}
%         \hline
%         \textbf{Action} & \textbf{Weight}\\
%         \hline
%          following & +1\\
%          like & +0.2\\
%          dislike & -0.2\\
%          \hline
%     \end{tabular}
%     \caption{Caption}
%     \label{tab:action_scores}
% \end{table}


\subsubsection{LLM-based opinion update}
Another possibility is to use LLM agents to update the opinion of the users they are impersonating.
In this case, they are prompted with the description of the topics to update and their coalition believes, their profile and previous opinion and the memory of what they have done since the last opinion update.

Specifically, the memory tracks the post a user reads and writes, what he replies, the reactions, and whether he changes the follow status with another user, after an interaction. 

The LLM is also asked to assign a stance towards the topics to update, choosing among a set of given labels. This allows the easy extraction of a numerical score, which is useful for the opinion analysis.

All prompts can be found in the appendix.