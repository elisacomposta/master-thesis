\section{Methods}
\label{sec:methods}

This section provides a description of the simulator and the implemented features.
First, it introduces the framework and its workflow.
Then, it details agent modeling, their initialization and behavior.
Finally, the implemented opinion models are described, including the impact of agent behavior on their opinions.

\subsection{Simulation workflow}
This work is based on Y, a social media digital twin \cite{rossetti2024ysocialllmpoweredsocial}.
Algorithm \ref{alg:workflow} describes the base workflow of the simulations. 
It preserves the core implementation, and extends it to include the opinion update at the end of the day.
The framework can be customized through a configuration file, which allows the specification of many parameters to model the desired environment.

The population of agents is initially created without any predefined network.
Throughout the simulation, agents can form and remove connections, allowing the network structure to emerge and evolve.

In each round, a number of active agents is sampled, according to the hourly activity defined in the configuration file.
Agents then perform their action, detailed in the next subsection, and eventually reply to received mentions.
%At the end of each day, a subsample of users are selected to follow a recommended user.
Finally, agents are asked to update their opinion on the topics they discussed during the day.

The original framework also allows to manage a percentage of agents that can leave or join the platform daily. This is omitted in the algorithm, as this study only focuses on those users who remain subscribed to the platform for the whole simulated time frame. 

\begin{algorithm}
\caption{Simulation workflow}
\label{alg:workflow}
\begin{algorithmic}[1]
\COMMENTLINE{Agents creation and initialization}
\STATE $agents \gets create\_population()$

\COMMENTLINE{Simulation loop}
\FOR{$day \in n\_days$}
    \FOR{$round \in n\_rounds$}
        \COMMENTLINE{Sample agents active in the current round}
        \STATE $n\_actives \gets len(agents) \times hourly\_activity[round]$
        \STATE $active\_agents \gets sample(agents, n\_actives)$ 
        \FOR{$agent \in active\_agents$}
            \COMMENTLINE{Perform actions}
            \STATE $agent.select\_action()$
            \STATE $agent.reply\_mentions()$
        \ENDFOR
    \ENDFOR

    \COMMENTLINE{Add new connections}
    \STATE $sel\_agents \gets sample(daily\_actives, percentage\_daily\_follows)$
    \FOR{$agent \in sel\_agents$}
        \STATE $agent.search\_and\_follow()$
    \ENDFOR

    \COMMENTLINE{Opinion update}
    \FOR{$agent \in daily\_actives$}
        \STATE $agent.update\_opinions()$
    \ENDFOR

\ENDFOR
\end{algorithmic}
\end{algorithm}



\subsection{Agents}
% Intro about the complexity of agents and the ability of LLMs to impersonate them (?)

\subsubsection{Initialization}
Agents in Y are initialized with various profile features, which contributes to the creation of users with a detailed description and characterization.

% Random data and personality
Some dimensions are randomly sampled: name, surname, email, password and personality.
Specifically, the personality is defined according to the Five-Factor Model \cite{McCrae1992}, mostly known as the Big Five model. 
Users can be either high or low in each dimension, as described Table \ref{tab:susceptibility}, which leads to at most 32 distinct personality types.

\medskip
% Age and gender
In this study, the age and gender of agents are randomly assigned, weighted according to 2024 Twitter statistics \cite{statista2024twitter}. Only the data for people aged 18 and above were considered, and the maximum age is set to 60, in line with the value in the original configuration of Y.

% Nationality and interests
Moreover, all agents are set with Italian nationality, in order to guarantee coherency with the context of the presented case study, and they are configured with four interests, corresponding to the four topics analyzed in this study: \textit{Immigration}, \textit{Nuclear energy}, \textit{Civil rights}, \textit{Reddito di Cittadinanza}.

\medskip
% Attributes from real data
To make the users even more realistic, some attributes have been initialized starting from real-world data, based on the dataset presented by \citet{pierri2023ita}. This includes Twitter posts collected around the Italian political elections in 2022.
Specifically, the attributes initialized from the dataset in this work are: the political leaning, the toxicity in writing posts and comments, and the activity level.
The activity is computed by converting the number of tweets written by each user into a continuous value in the range $[0,1]$, using the following logarithmic normalization:

\[
activity_x = \min\left( \frac{\log(1 + n\_posts_x)}{\log(1 + N_{99.5})},\ 1.0 \right)
\]

where $n\_posts_x$ is the number of posts written by user $x$, and $N_{99.5}$ is the 99.5th percentile, used to mitigate the impact of outliers.


\subsubsection{Behavior}
When an agent is active, one among the following actions is performed:
\begin{itemize}
    \item \textbf{post}: writing a tweet about a given topic.
    \item \textbf{comment}: after reading a given conversation, the agent is asked to comment it; he can then decide to add a reaction (\textit{like} or \textit{dislike}), and \textit{follow} (\textit{unfollow}) its author.
    \item \textbf{read}: after reading a given tweet, the agent can decide to add a reaction (\textit{like} or \textit{dislike}) and \textit{follow} (\textit{unfollow}) its author, without adding any contribution to the conversation.
\end{itemize}

\medskip
% Select action
In the original implementation of Y, the agents were responsible of choosing which action to perform.
This work instead uses the agent's posting and commenting activity (each in the range $[0,1]$) as probabilities. If their sum is less then 1, the remaining probability is assigned to the \textit{read} action.
This implementation allows to model the agent behavior leveraging the real data available in this study.

\medskip
% Agent roles and prompts
The framework uses AutoGen \cite{pyautogen0.2.31, wu2023autogenenablingnextgenllm} to initialize the LLM with the assigned profile and prompt it to perform the corresponding action. All the prompts can be found in Appendix \ref{app:prompts}.


\subsubsection{Misinformation agents}
This work extends the agents modeled by Y, by introducing some special agents, designed to generate misinformation.
These agents are not bots nor coordinated agents: they are designed as all other normal agents, and they are prompted with a profile including demographics and personality.

% Misinformation content
The main difference is that they are encouraged to generate misleading content supporting their views:

\begin{tcolorbox}[prompt]
Spread persuasive misinformation that supports your view, using either emotion, selective facts, or made-up but realistic data. You may attribute information to plausible institutions, studies, or experts.
\end{tcolorbox}

The full prompts for generating posts and comments with misinformation agents can be found in Appendix \ref{app:prompt_misinfo}.

\medskip
% Coalition assignment, toxicity and activity generation
Another difference is that these agents are not directly initialized with the data of real users.
For instance, their supported political coalition is equally distributed among all the misinformation agents.
Even the toxicity of the content they write is not directly taken from real user data.
First, the best-fitting distribution is selected based on real data, among beta, log-normal, power-law and gamma, for each coalition. Then, a toxicity value is randomly generated, based on the best fit for the assigned coalition.
Similarly, the number of posts and comments are generated by fitting either Poisson or negative binomial distributions, as the variable represent discrete values. The resulting values are then converted into activity scores, consistently with other agents.

\subsection{Opinion modeling and update}
Modeling the opinion is one of the crucial aspects for this works. A good opinion modeling means more realistic simulation of the agent behavior and believes.
In this work, we have implemented two types of opinion models in parallel. The first is the mathematical way, and we have implemented some basic score aggregation and various known models. The second better leverages LLM reasoning capabilities, to both express the textual opinion, and assign a score. 
In this subsection we'll enter into the details of these methods implemented.

\subsubsection{Implemented opinion models}
% median, weighted mean
The most basic implementation of opinions are the median and the weighted mean of previous scores, for each individual. These can be used where the opinion scores are externally added, and a final opinion evaluator is needed. For instance, after writing a tweet a score might be extracted and considered as the current user belief. To aggregate all these values to give an overall opinion of the individual, these ways can be used.

% friedkin johnsen
A well-known mathematical model of opinion dynamics is the Friedkin-Johnsen model. As introduced in the previous section, it considers both the user initial opinion and the opinion of the user neighbors (the following, in our case), weighted by a susceptibility value.
The implemented formula is the following:
\[
x_i(t + 1) = (1 - \lambda_i) x_i(0) + \lambda_i  \sum_{j \in N_i(t)} w_{ij} x_j (t)
\]
where $x_i$ is the opinion of individual $i$, $N_i$ is the set of following users, and $\lambda$ is the susceptibility to other users. 
Note that in this first implementation neighbors are followed users, and they all have the same weight.
The susceptibility is a score in the range 0-1 (0 means not susceptible, 1 very susceptible), and is assigned according to the user personality, assigned in the agent initialization phase. Specifically, it is the mean of the susceptibility scores for each assigned personality trait. These scores are visible in Table \ref{tab:susceptibility}, and have been assigned based on to the work presented by \citet{oyibo2019personality}, which highlights the personality impact on the social susceptibility. For the traits that are not mentioned to have a clear strong impact, the neutral score has been assigned.

\begin{table}[h]
\centering
\begin{tabular}{|l|l|l|c|}
\hline
\textbf{Trait} & \textbf{Trait level} & \textbf{Description} & \textbf{Susceptibility score} \\
\hline
\multirow{2}{*}{Neuroticism}       
  & High & sensitive/nervous         & 0.9 \\
  & Low & resilient/confident        & 0.1 \\
\hline
\multirow{2}{*}{Openness to experience}          
  & High & inventive/curious         & 0.2 \\
  & Low & consistent/cautious        & 0.6 \\
\hline
\multirow{2}{*}{Conscientiousness} 
  & High & efficient/organized       & 0.2 \\
  & Low & extravagant/careless       & 0.6 \\
\hline
\multirow{2}{*}{Extroversion}      
  & High & outgoing/energetic        & 0.5 \\
  & Low & solitary/reserved          & 0.5 \\
\hline
\multirow{2}{*}{Agreeableness}     
  & High & friendly/compassionate    & 0.5 \\
  & Low & critical/judgmental        & 0.5 \\
\hline
\end{tabular}
\caption{The table shows the susceptibility scores assigned to each personality trait. Values range from 0 (not susceptible) to 1 (highly susceptible).}
\label{tab:susceptibility}
\end{table}

% state dependent friedkin-johnsen
Another implementation implemented for this work is an extension of the Friedkin-Johnsen model which is state-dependent, as it considers the influence of the current opinion, rather than the initial one \cite{Ye2018Opinion}:
\[
x_i(t + 1) = (1 - \lambda) x_i(t) + \lambda  \sum_{j \in N_i(t)} w_{ij} x_j (t)
\]

% weighted state depended fj
The last implementation is the state dependent Friedkin-Johnsen model just introduced, but with different scores for the neighbors. 
First of all, neighbors are not only followed users, but all users the individual has interacted with, since the last opinion update, and their weight depends on the interactions. 
The scores are assigned as follows: following user +1; like/dislike: Â±0.2

% The scores are visible in Table \ref{tab:action_scores}.
% \begin{table}[h]
%     \centering
%     \begin{tabular}{|l|c|}
%         \hline
%         \textbf{Action} & \textbf{Weight}\\
%         \hline
%          following & +1\\
%          like & +0.2\\
%          dislike & -0.2\\
%          \hline
%     \end{tabular}
%     \caption{Caption}
%     \label{tab:action_scores}
% \end{table}


\subsubsection{LLM-based opinion update}
Another possibility is to use LLM agents to update the opinion of the users they are impersonating.
In this case, they are prompted with the description of the topics to update and their coalition believes, their profile and previous opinion and the memory of what they have done since the last opinion update.

Specifically, the memory tracks the post a user reads and writes, what he replies, the reactions, and whether he changes the follow status with another user, after an interaction. 

The LLM is also asked to assign a stance towards the topics to update, choosing among a set of given labels. This allows the easy extraction of a numerical score, which is useful for the opinion analysis.

All prompts can be found in the appendix.